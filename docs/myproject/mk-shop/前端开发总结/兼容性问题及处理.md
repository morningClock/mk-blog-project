# 兼容性问题及处理

## 导航栏

​	`uniapp`自带原生导航栏，在`pages.json`里配置。原生导航的体验更好，渲染新页面时，原生导航栏的渲染无需等待新页面`dom`加载，可以在新页面进入动画开始时就渲染。原生导航还可以避免滚动条通顶，并方便的控制原生下拉刷新。通过`pages.json`的配置，可以简单的、跨端的、高性能的开发业务。

​	而且，在配置中配置原生导航栏，可以在导航栏上实现许多基础的功能拓展，比如搜索栏，自定义标签，自定义颜色，以及自定义按钮事件的绑定等功能，但是缺点也是显而易见，就是兼容性问题比较突出，因为纵使导航栏支持的配置满足业务，但是在`微信端`的原生导航栏提供的功能就寥寥无几了。往往编写的功能丰富的原生导航栏，在微信端都不能兼容。通过阅读官方文档，总结出如下方案。

#### 方案1：两版导航栏

- 优点：在`APP-PLUS`兼容的端能利用好原生导航栏带来的性能优势。
- 缺点：需要使用`条件编译`来编写一版微信小程序端的自定义导航栏。

#### 方案2：隐藏原生导航栏，自定义导航栏

- 配置方法

  ```json
  // 部分页面隐藏原生导航栏
  {
      "path": "pages/address/index",
      "style": {
      	"navigationStyle": "custom"
      }
  },
  // 全局隐藏原生导航栏
  "globalStyle": {
      "navigationStyle": "custom"
  }
  ```

- 优点：编写一版导航栏，不需要进行多版导航栏维护。
- 缺点：微信小程序和小游戏右上角始终都有一个胶囊按钮，会遮挡自定义导航栏。

> 注意：使用自定义导航栏，在手机端会因为沉浸模式，导致页面顶部是贴近屏幕边缘而忽略了手机的状态栏的。
>
> 为了解决这个问题，需要对页面样式进行处理，使用CSS变量`var(--status-bar-height)`重新撑开状态栏的高度。



## 小程序组件会渲染出一个组件标签

问题：小程序自定义组件和APP/H5有差异，会多出一层组件标签的结构，需要注意样式的编写。

注意事项：[uniapp 小程序开发注意](https://uniapp.dcloud.io/matter.html#mp)



### slot默认插槽兼容

#### 说明：

​	小程序没有默认插槽，只能使用命名插槽

#### 问题场景：

```vue
// card.vue
<view>
	// 插槽
	<slot></slot>
</view>
```

```vue
// cardlist.vue
<view>
	<Card>我要插入插槽</Card>
</view>
```

#### 渲染结果：

```vue
// 小程序渲染的结构
<view>
	<card> // ** 小程序会把组件也渲染成一层 **
    	<view></view>
    </card>
    // 错误：由于小程序无法找到对应的slot，只会在slot组件后面，增加一个view将slot填充，所以此处的展示为错位渲染了
    <view>我要插入插槽<view> 
</view>
```

#### 问题解决：

```vue
// card.vue
<view>
	// 命名插槽，uniapp即可兼容小程序和h5插槽
	<slot name="default"></slot>
</view>
```

```vue
// cardlist.vue
<view>
	<Card>我要插入插槽</Card>
</view>
```



#### 问题原因分析：

> 发生错位渲染结构分析：
>
>  	由于小程序渲染组件时，无法找到对应的slot结构进行内容插入，所以把自定义组件中的内容，插入到自定义组件的后面的一个view结构中。
>
> 根本原因: 
>
> ​	小程序不支持非命名插槽，默认插槽命名为default



## 样式的动态绑定问题

#### 问题：

1. 小程序端不支持 `classObject` 和 `styleObject` 语法。
2. 不支持``模板字符串符号

#### 解决：

​	使用字符串拼接

#### 相关文档：

​	[小程序端差异化的样式动态绑定](https://uniapp.dcloud.io/tutorial/vue-basics.html#class-%E4%B8%8E-style-%E7%BB%91%E5%AE%9A)


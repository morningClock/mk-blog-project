(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{266:function(t,a,s){t.exports=s.p+"assets/img/产品表ER图.11bb9825.png"},267:function(t,a,s){t.exports=s.p+"assets/img/产品表数据结构图.efc7897a.png"},268:function(t,a,s){t.exports=s.p+"assets/img/商品表ER图.f5f3a141.png"},269:function(t,a,s){t.exports=s.p+"assets/img/商品数据结构图.8090c00e.png"},270:function(t,a,s){t.exports=s.p+"assets/img/属性表ER图.7cd52ca0.png"},271:function(t,a,s){t.exports=s.p+"assets/img/属性表数据结构图.7299b6f2.png"},272:function(t,a,s){t.exports=s.p+"assets/img/属性值表ER图.7f4c6657.png"},273:function(t,a,s){t.exports=s.p+"assets/img/属性值表数据结构图.b9ca8bcd.png"},274:function(t,a,s){t.exports=s.p+"assets/img/产品总库存-总销量派生视图表.2f60921d.png"},326:function(t,a,s){"use strict";s.r(a);var e=s(13),_=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"商品模块表设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#商品模块表设计"}},[t._v("#")]),t._v(" 商品模块表设计")]),t._v(" "),a("h2",{attrs:{id:"产品表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#产品表"}},[t._v("#")]),t._v(" 产品表")]),t._v(" "),a("h3",{attrs:{id:"产品表-er-图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#产品表-er-图"}},[t._v("#")]),t._v(" 产品表 ER 图")]),t._v(" "),a("p",[a("img",{attrs:{src:s(266),alt:"image-20220726151942938"}})]),t._v(" "),a("h4",{attrs:{id:"关键数据说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关键数据说明"}},[t._v("#")]),t._v(" 关键数据说明")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("商家店铺编号：关联新增该产品店铺id，产品由商家的店铺管理")])]),t._v(" "),a("li",[a("p",[t._v("品牌编号：可以为空，没有品牌")]),t._v(" "),a("p",[t._v("一些散装的可能没有品牌，比如花生之类的")])]),t._v(" "),a("li",[a("p",[t._v("分类编号：关联分类，用于产品分类检索。")]),t._v(" "),a("p",[t._v("比如：属于手机类，会在手机分类下面查询得到该商品。")])]),t._v(" "),a("li",[a("p",[t._v("参数属性：关联产品所选的参数属性，形成sku。")]),t._v(" "),a("p",[t._v("比如：iphone8产品拥有的属性：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("颜色")]),t._v(" "),a("p",[t._v("黑、白、蓝")])]),t._v(" "),a("li",[a("p",[t._v("内存")]),t._v(" "),a("p",[t._v("128G 256G 1TB")])])]),t._v(" "),a("p",[t._v("获取的商品详情时，可以通过该属性，查询所有可选的sku参数，然后用于页面可选选项的显示。")]),t._v(" "),a("blockquote",[a("p",[t._v("表优化：如果想增加一些商品的常规规格属性，而又不想每次都添加时，可以增加一个品类表通过关联品类来设置通用属性。比如说衣服品类，都需要设置面料，规格尺寸，厂家等属性，可以通过品类进行约束设置。")])])])]),t._v(" "),a("h3",{attrs:{id:"产品表数据结构图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#产品表数据结构图"}},[t._v("#")]),t._v(" 产品表数据结构图")]),t._v(" "),a("p",[a("img",{attrs:{src:s(267),alt:"image-20220726152202399"}})]),t._v(" "),a("h4",{attrs:{id:"建表语句"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#建表语句"}},[t._v("#")]),t._v(" 建表语句")]),t._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("CREATE TABLE `t_prod` (\n  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '产品id',\n  `shop_id` bigint(20) unsigned DEFAULT NULL COMMENT '所属商家店铺',\n  `brand_id` bigint(20) unsigned DEFAULT NULL COMMENT '所属品牌id',\n  `category_id` bigint(20) unsigned DEFAULT NULL COMMENT '所属分类id',\n  `name` varchar(300) NOT NULL COMMENT '产品名称',\n  `title` varchar(300) DEFAULT NULL COMMENT '产品标题',\n  `sub_title` varchar(300) DEFAULT NULL COMMENT '产品副标题',\n  `picture` json DEFAULT NULL COMMENT '产品主图',\n  `images` json DEFAULT NULL COMMENT '产品图片集',\n  `description` varchar(500) DEFAULT NULL COMMENT '产品简介',\n  `content` json DEFAULT NULL COMMENT '产品详细描述',\n  `price` decimal(15,2) DEFAULT NULL COMMENT '产品现价',\n  `ori_price` decimal(15,2) DEFAULT NULL COMMENT '产品原价',\n  `attrs` json DEFAULT NULL COMMENT '产品可选的属性',\n  `status` tinyint(1) unsigned DEFAULT '0' COMMENT '发布状态(0:未上架(默认),1:已上架)',\n  `is_deleted` tinyint(1) unsigned DEFAULT '0' COMMENT '逻辑删除(0:正常(默认), 1:已删除)',\n  `putaway_time` datetime DEFAULT NULL COMMENT '产品上架时间',\n  `gmt_create` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '记录时间',\n  `gmt_modified` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8\n\n")])])]),a("h2",{attrs:{id:"商品表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#商品表"}},[t._v("#")]),t._v(" 商品表")]),t._v(" "),a("h3",{attrs:{id:"商品表er图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#商品表er图"}},[t._v("#")]),t._v(" 商品表ER图")]),t._v(" "),a("p",[a("img",{attrs:{src:s(268),alt:"image-20220726152919025"}})]),t._v(" "),a("h3",{attrs:{id:"产品表数据结构图-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#产品表数据结构图-2"}},[t._v("#")]),t._v(" 产品表数据结构图")]),t._v(" "),a("p",[a("img",{attrs:{src:s(269),alt:"image-20220726155024104"}})]),t._v(" "),a("h4",{attrs:{id:"建表语句-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#建表语句-2"}},[t._v("#")]),t._v(" 建表语句")]),t._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("CREATE TABLE `t_sku` (\n  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT 'sku商品id',\n  `prod_id` bigint(20) unsigned NOT NULL COMMENT '所属产品的id',\n  `sku_name` varchar(200) DEFAULT NULL COMMENT 'sku商品名称',\n  `sku_attrs` json DEFAULT NULL COMMENT '销售属性组合json 格式是{a1:v1;a2:v2}',\n  `price` decimal(15,2) DEFAULT NULL COMMENT '商品现价',\n  `ori_price` decimal(15,2) DEFAULT NULL COMMENT '商品原价',\n  `stock` int(11) DEFAULT NULL COMMENT '商品在付款减库存的状态下，该sku上未付款的订单数量',\n  `actual_stock` int(11) DEFAULT NULL COMMENT '实际库存',\n  `sold_num` int(11) DEFAULT NULL COMMENT '单品销量',\n  `picture` json DEFAULT NULL COMMENT '单品主图',\n  `status` tinyint(1) DEFAULT '0' COMMENT '发布状态(0:未上架(默认),1:已上架)',\n  `is_deleted` tinyint(1) unsigned DEFAULT '0' COMMENT '逻辑删除(0:正常(默认), 1:已删除)',\n  `putaway_time` datetime DEFAULT NULL COMMENT '单品上架时间',\n  `gmt_create` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',\n  `gmt_modified` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8\n\n")])])]),a("h2",{attrs:{id:"属性表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#属性表"}},[t._v("#")]),t._v(" 属性表")]),t._v(" "),a("h3",{attrs:{id:"er图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#er图"}},[t._v("#")]),t._v(" ER图")]),t._v(" "),a("p",[a("img",{attrs:{src:s(270),alt:"image-20220726171104945"}})]),t._v(" "),a("h4",{attrs:{id:"关键数据说明-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关键数据说明-2"}},[t._v("#")]),t._v(" 关键数据说明")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("参数类型：规格 OR 参数属性")]),t._v(" "),a("p",[t._v("规格类型是不可选择的，而参数类型是供sku使用。")])]),t._v(" "),a("li",[a("p",[t._v("店铺id:")]),t._v(" "),a("p",[t._v("参数由店铺创建，可以用于所有店铺内的产品。")])])]),t._v(" "),a("h3",{attrs:{id:"数据结构图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据结构图"}},[t._v("#")]),t._v(" 数据结构图")]),t._v(" "),a("p",[a("img",{attrs:{src:s(271),alt:"image-20220726173154798"}})]),t._v(" "),a("h4",{attrs:{id:"建表语句-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#建表语句-3"}},[t._v("#")]),t._v(" 建表语句")]),t._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("CREATE TABLE `t_prod_attr` (\n  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '属性id',\n  `shop_id` bigint(20) unsigned NOT NULL COMMENT '所属店铺id',\n  `attr_name` varchar(50) DEFAULT NULL COMMENT '属性名称',\n  `rule` tinyint(2) DEFAULT '1' COMMENT '1:销售属性(规格); 2:参数属性;',\n  `is_deleted` tinyint(1) unsigned DEFAULT '0' COMMENT '逻辑删除(0:正常(默认), 1:已删除)',\n  `gmt_create` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',\n  `gmt_modified` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8\n")])])]),a("h2",{attrs:{id:"属性值表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#属性值表"}},[t._v("#")]),t._v(" 属性值表")]),t._v(" "),a("h3",{attrs:{id:"er图-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#er图-2"}},[t._v("#")]),t._v(" ER图")]),t._v(" "),a("p",[a("img",{attrs:{src:s(272),alt:"image-20220726171122444"}})]),t._v(" "),a("h3",{attrs:{id:"数据结构图-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据结构图-2"}},[t._v("#")]),t._v(" 数据结构图")]),t._v(" "),a("p",[a("img",{attrs:{src:s(273),alt:"image-20220726173238957"}})]),t._v(" "),a("h4",{attrs:{id:"建表语句-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#建表语句-4"}},[t._v("#")]),t._v(" 建表语句")]),t._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("CREATE TABLE `t_prod_attr_value` (\n  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '属性值的id',\n  `attr_id` bigint(20) unsigned NOT NULL COMMENT '所属属性参数id',\n  `attr_value` varchar(50) DEFAULT NULL COMMENT '属性值',\n  `is_deleted` tinyint(1) unsigned DEFAULT '0' COMMENT '逻辑删除(0:正常(默认), 1:已删除)',\n  `gmt_create` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',\n  `gmt_modified` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8\n")])])]),a("h2",{attrs:{id:"关键业务设计与说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关键业务设计与说明"}},[t._v("#")]),t._v(" 关键业务设计与说明")]),t._v(" "),a("h3",{attrs:{id:"sku商品如何产生"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sku商品如何产生"}},[t._v("#")]),t._v(" SKU商品如何产生？")]),t._v(" "),a("p",[t._v("​\t在商家后台管理系统中，当商家新增产品时，需要管理产品对应的SKU商品，完成新增后将SKU商品信息（此处接口参数名设为"),a("code",[t._v("skuList")]),t._v("）一并发送到"),a("code",[t._v("addProduct")]),t._v("相关业务接口中。")]),t._v(" "),a("p",[t._v("此时接口处理逻辑：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("插入新产品信息至"),a("code",[t._v("t_prod")]),t._v("表")])]),t._v(" "),a("li",[a("p",[t._v("查询接口传入的prod_id，查询数据库中所有当前产品的sku的ID，存入"),a("code",[t._v("dbSkuIds")]),t._v("的集合中")])]),t._v(" "),a("li",[a("p",[t._v("将接口获取的"),a("code",[t._v("skuList")]),t._v("参数进行过滤，并遍历将数据插入sku表，存在一下处理情况")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("skuItem")]),t._v("（"),a("code",[t._v("skuItem")]),t._v("为接口传入的"),a("code",[t._v("SkuList")]),t._v("遍历出来的单列数据）存在id属性，查询"),a("code",[t._v("dbSkuIds")]),t._v("是否存在该id")]),t._v(" "),a("ul",[a("li",[t._v("存在id，则将该列数据更新至指定id的数据库记录中")]),t._v(" "),a("li",[t._v("不存在id，插入该列数据")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("skuItem")]),t._v("不存在id")]),t._v(" "),a("p",[t._v("插入该列数据")])])])])]),t._v(" "),a("h3",{attrs:{id:"如何获取sku选项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何获取sku选项"}},[t._v("#")]),t._v(" 如何获取sku选项？")]),t._v(" "),a("p",[t._v("​\t在商城端商品详情，需要sku选项展示，并提供给用户选择指定的单品加入购物车，此时需要通过产品字段"),a("code",[t._v("attrs")]),t._v("字段，通过"),a("code",[t._v("attr")]),t._v("的"),a("code",[t._v("id")]),t._v("在"),a("code",[t._v("t_prod_attr")]),t._v("表中所有可选参数，然后再通过"),a("code",[t._v("t_prod_attr_value")]),t._v("查询出所有可选sku选项，把数据整合渲染到商城的供用户选择。")]),t._v(" "),a("h3",{attrs:{id:"如何默认选择sku选项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何默认选择sku选项"}},[t._v("#")]),t._v(" 如何默认选择sku选项？")]),t._v(" "),a("p",[t._v("​\t点击sku单品进入详情页后，根据"),a("code",[t._v("sku_id")]),t._v("查询sku商品信息，再通过"),a("code",[t._v("t_sku")]),t._v("表的"),a("code",[t._v("sku_attrs")]),t._v("，提取出当前商品对应的sku属性，并让选项高亮。")]),t._v(" "),a("h3",{attrs:{id:"如何获取产品的总销量和总库存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何获取产品的总销量和总库存"}},[t._v("#")]),t._v(" 如何获取产品的总销量和总库存？")]),t._v(" "),a("h4",{attrs:{id:"方案一-创建派生视图-不推荐"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方案一-创建派生视图-不推荐"}},[t._v("#")]),t._v(" 方案一：创建派生视图（不推荐）")]),t._v(" "),a("p",[a("img",{attrs:{src:s(274),alt:"image-20220726152630175"}})]),t._v(" "),a("p",[t._v("建表语句：")]),t._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("SELECT prod_id, SUM(stock) AS `total_stock`, sold_num \nFROM `tz_sku` \nWHERE `is_delete` = 0 AND `status` = 1 \nGROUP BY prod_id \n")])])]),a("blockquote",[a("p",[t._v("说明：该视图表由sku表派生，用作产品的总销量和总库存查询业务")]),t._v(" "),a("p",[t._v("不推荐的原因：")]),t._v(" "),a("p",[t._v("1.由于查询视图会执行相应的查询代码，导致效率下降。")]),t._v(" "),a("p",[t._v("2.视图/存储过程都应该通过编写程序代码替代，使用程序应用编写可以缓存数据结果，减少查询次数，所以更灵活更利于后期维护。")])]),t._v(" "),a("h4",{attrs:{id:"方案二-业务代码中执行查询-通过sku表进行查询相关数据-推荐"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方案二-业务代码中执行查询-通过sku表进行查询相关数据-推荐"}},[t._v("#")]),t._v(" 方案二：业务代码中执行查询，通过sku表进行查询相关数据（推荐）")]),t._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("SELECT SUM(stock) AS `total_stock`, sold_num \nFROM `t_sku` \nWHERE prod_id = `[目标prod_id]` AND `is_delete` = 0 AND `status` = 1 # 排除删除和未上架状态商品\nGROUP BY prod_id \n")])])])])}),[],!1,null,null,null);a.default=_.exports}}]);